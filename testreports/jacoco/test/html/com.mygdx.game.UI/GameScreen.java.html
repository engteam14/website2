<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../jacoco-resources/report.css" type="text/css"/><link rel="shortcut icon" href="../jacoco-resources/report.gif" type="image/gif"/><title>GameScreen.java</title><link rel="stylesheet" href="../jacoco-resources/prettify.css" type="text/css"/><script type="text/javascript" src="../jacoco-resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../jacoco-sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">core</a> &gt; <a href="index.source.html" class="el_package">com.mygdx.game.UI</a> &gt; <span class="el_source">GameScreen.java</span></div><h1>GameScreen.java</h1><pre class="source lang-java linenums">package com.mygdx.game.UI;

import com.badlogic.gdx.Gdx;
import com.badlogic.gdx.Input;
import com.badlogic.gdx.graphics.OrthographicCamera;
import com.badlogic.gdx.scenes.scene2d.ui.Image;
import com.badlogic.gdx.scenes.scene2d.ui.Label;
import com.badlogic.gdx.scenes.scene2d.ui.Table;
import com.badlogic.gdx.scenes.scene2d.ui.Window;
import com.badlogic.gdx.utils.ScreenUtils;
import com.mygdx.game.Components.ComponentEvent;
import com.mygdx.game.Entitys.Player;
import com.mygdx.game.Managers.*;
import com.mygdx.game.PirateGame;
import com.mygdx.game.Quests.Quest;

import static com.mygdx.utils.Constants.*;

public class GameScreen extends Page {
    private Label healthLabel;
    private Label dosh;
    private Label ammo;
    private final Label questDesc;
    private final Label questName;
    /*private final Label questComplete;
    private float showTimer = 0;
    // in seconds
    private static final float showDuration = 1;*/

    /**
     * Boots up the actual game: starts PhysicsManager, GameManager, EntityManager,
     * loads texture atlases into ResourceManager. Draws quest and control info.
     *
     * @param parent PirateGame UI screen container
     * @param id_map the resource id of the tile map
     */
    public GameScreen(PirateGame parent, int id_map) {
<span class="nc" id="L38">        super(parent);</span>
<span class="nc" id="L39">        INIT_CONSTANTS();</span>
<span class="nc" id="L40">        PhysicsManager.Initialize(false);</span>

        /*int id_ship = ResourceManager.addTexture(&quot;ship.png&quot;);
        int id_map = ResourceManager.addTileMap(&quot;Map.tmx&quot;);
        int atlas_id = ResourceManager.addTextureAtlas(&quot;Boats.txt&quot;);
        int extras_id = ResourceManager.addTextureAtlas(&quot;UISkin/skin.atlas&quot;);
        int buildings_id = ResourceManager.addTextureAtlas(&quot;Buildings.txt&quot;);
        ResourceManager.loadAssets();*/


<span class="nc" id="L50">        GameManager.SpawnGame(id_map);</span>
        //QuestManager.addQuest(new KillQuest(c));

<span class="nc" id="L53">        EntityManager.raiseEvents(ComponentEvent.Awake, ComponentEvent.Start);</span>

<span class="nc" id="L55">        Window questWindow = new Window(&quot;Current Quest&quot;, parent.skin);</span>

<span class="nc" id="L57">        Quest q = QuestManager.currentQuest();</span>
<span class="nc" id="L58">        Table t = new Table();</span>
<span class="nc" id="L59">        questName = new Label(&quot;NAME&quot;, parent.skin);</span>
<span class="nc" id="L60">        t.add(questName);</span>
<span class="nc" id="L61">        t.row();</span>
<span class="nc" id="L62">        questDesc = new Label(&quot;DESCRIPTION&quot;, parent.skin);</span>
<span class="nc bnc" id="L63" title="All 2 branches missed.">        if (q != null) {</span>
<span class="nc" id="L64">            questName.setText(q.getName());</span>
<span class="nc" id="L65">            questDesc.setText(q.getDescription());</span>
        }
        /*questComplete = new Label(&quot;&quot;, parent.skin);
        actors.add(questComplete);*/

<span class="nc" id="L70">        t.add(questDesc).left();</span>
<span class="nc" id="L71">        questWindow.add(t);</span>
<span class="nc" id="L72">        actors.add(questWindow);</span>

<span class="nc" id="L74">        Table t1 = new Table();</span>
<span class="nc" id="L75">        t1.top().right();</span>
<span class="nc" id="L76">        t1.setFillParent(true);</span>
<span class="nc" id="L77">        actors.add(t1);</span>

<span class="nc" id="L79">        Window tutWindow = new Window(&quot;Controls&quot;, parent.skin);</span>
<span class="nc" id="L80">        Table table = new Table();</span>
<span class="nc" id="L81">        tutWindow.add(table);</span>
<span class="nc" id="L82">        t1.add(tutWindow);</span>

<span class="nc" id="L84">        table.add(new Label(&quot;Move with&quot;, parent.skin)).top().left();</span>
<span class="nc" id="L85">        table.add(new Image(parent.skin, &quot;key-w&quot;));</span>
<span class="nc" id="L86">        table.add(new Image(parent.skin, &quot;key-s&quot;));</span>
<span class="nc" id="L87">        table.add(new Image(parent.skin, &quot;key-a&quot;));</span>
<span class="nc" id="L88">        table.add(new Image(parent.skin, &quot;key-d&quot;));</span>
<span class="nc" id="L89">        table.row();</span>
<span class="nc" id="L90">        table.add(new Label(&quot;Shoot in direction of mouse&quot;, parent.skin)).left();</span>
        //table.add(new Image(parent.skin, &quot;space&quot;));
<span class="nc" id="L92">        table.add(new Image(parent.skin, &quot;mouse&quot;));</span>
<span class="nc" id="L93">        table.row();</span>
<span class="nc" id="L94">        table.add(new Label(&quot;Shoot in direction of ship&quot;, parent.skin)).left();</span>
<span class="nc" id="L95">        table.add(new Image(parent.skin, &quot;space&quot;));</span>
<span class="nc" id="L96">        table.row();</span>
<span class="nc" id="L97">        table.add(new Label(&quot;Quit&quot;, parent.skin)).left();</span>
<span class="nc" id="L98">        table.add(new Image(parent.skin, &quot;key-esc&quot;));</span>

<span class="nc" id="L100">    }</span>

    private float accumulator;

    /**
     * Called every frame calls all other functions that need to be called every frame by rasing events and update methods
     *
     * @param delta delta time
     */
    @Override
    public void render(float delta) {
<span class="nc" id="L111">        ScreenUtils.clear(BACKGROUND_COLOUR.x, BACKGROUND_COLOUR.y, BACKGROUND_COLOUR.z, 1);</span>

<span class="nc" id="L113">        EntityManager.raiseEvents(ComponentEvent.Update, ComponentEvent.Render);</span>

<span class="nc" id="L115">        accumulator += EntityManager.getDeltaTime();</span>

        // fixed update loop so that physics manager is called regally rather than somewhat randomly
<span class="nc bnc" id="L118" title="All 2 branches missed.">        while (accumulator &gt;= PHYSICS_TIME_STEP) {</span>
<span class="nc" id="L119">            PhysicsManager.update();</span>
<span class="nc" id="L120">            accumulator -= PHYSICS_TIME_STEP;</span>
        }

<span class="nc" id="L123">        GameManager.update();</span>
        // show end screen if esc is pressed
<span class="nc bnc" id="L125" title="All 2 branches missed.">        if (Gdx.input.isKeyJustPressed(Input.Keys.ESCAPE)) {</span>
<span class="nc" id="L126">            parent.setScreen(parent.end);</span>
        }
<span class="nc" id="L128">        super.render(delta);</span>
<span class="nc" id="L129">    }</span>

    /**
     * disposed of all stuff it something is missing from this method you will get memory leaks
     */
    @Override
    public void dispose() {
<span class="nc" id="L136">        super.dispose();</span>
<span class="nc" id="L137">        ResourceManager.cleanUp();</span>
<span class="nc" id="L138">        EntityManager.cleanUp();</span>
<span class="nc" id="L139">        RenderingManager.cleanUp();</span>
<span class="nc" id="L140">        PhysicsManager.cleanUp();</span>
<span class="nc" id="L141">    }</span>

    /**
     * Resize camera, effectively setting the viewport to display game assets
     * at pixel ratios other than 1:1.
     *
     * @param width  of camera viewport
     * @param height of camera viewport
     */
    @Override
    public void resize(int width, int height) {
        //((Table) actors.get(0)).setFillParent(false);
<span class="nc" id="L153">        super.resize(width, height);</span>
<span class="nc" id="L154">        OrthographicCamera cam = RenderingManager.getCamera();</span>
<span class="nc" id="L155">        cam.viewportWidth = width / ZOOM;</span>
<span class="nc" id="L156">        cam.viewportHeight = height / ZOOM;</span>
<span class="nc" id="L157">        cam.update();</span>

        // ((Table) actors.get(0)).setFillParent(true);
<span class="nc" id="L160">    }</span>

    /**
     * Update the UI with new values for health, quest status, etc.
     * also called once per frame but used for actors by my own convention
     */
    //private String prevQuest = &quot;&quot;;
    @Override
    protected void update() {
<span class="nc" id="L169">        super.update();</span>
<span class="nc" id="L170">        Player p = GameManager.getPlayer();</span>

<span class="nc" id="L172">        healthLabel.setText(String.valueOf(p.getHealth()));</span>
<span class="nc" id="L173">        dosh.setText(String.valueOf(p.getPlunder()));</span>
<span class="nc" id="L174">        ammo.setText(String.valueOf(p.getAmmo()));</span>
<span class="nc bnc" id="L175" title="All 2 branches missed.">        if (!QuestManager.anyQuests()) {</span>
<span class="nc" id="L176">            parent.end.win();</span>
<span class="nc" id="L177">            parent.setScreen(parent.end);</span>

        } else {
<span class="nc" id="L180">            Quest q = QuestManager.currentQuest();</span>
            /*if(Objects.equals(prevQuest, &quot;&quot;)) {
                prevQuest = q.getDescription();
            }
            if(!Objects.equals(prevQuest, q.getDescription())) {
                questComplete.setText(&quot;Quest Competed&quot;);
                prevQuest = &quot;&quot;;
            }*/
<span class="nc" id="L188">            questName.setText(q.getName());</span>
<span class="nc" id="L189">            questDesc.setText(q.getDescription());</span>
        }
        /*if(!questComplete.getText().equals(&quot;&quot;)) {
            showTimer += EntityManager.getDeltaTime();
        }
        if(showTimer &gt;= showDuration) {
            showTimer = 0;
            questComplete.setText(&quot;&quot;);
        }*/
<span class="nc" id="L198">    }</span>

    /**
     * Draw UI elements showing player health, plunder, and ammo.
     */
    @Override
    protected void CreateActors() {
<span class="nc" id="L205">        Table table = new Table();</span>
<span class="nc" id="L206">        table.setFillParent(true);</span>
<span class="nc" id="L207">        actors.add(table);</span>

<span class="nc" id="L209">        table.add(new Image(parent.skin.getDrawable(&quot;heart&quot;))).top().left().size(1.25f * TILE_SIZE);</span>
<span class="nc" id="L210">        healthLabel = new Label(&quot;N/A&quot;, parent.skin);</span>
<span class="nc" id="L211">        table.add(healthLabel).top().left().size(50);</span>

<span class="nc" id="L213">        table.row();</span>
<span class="nc" id="L214">        table.setDebug(false);</span>

<span class="nc" id="L216">        table.add(new Image(parent.skin.getDrawable(&quot;coin&quot;))).top().left().size(1.25f * TILE_SIZE);</span>
<span class="nc" id="L217">        dosh = new Label(&quot;N/A&quot;, parent.skin);</span>
<span class="nc" id="L218">        table.add(dosh).top().left().size(50);</span>

<span class="nc" id="L220">        table.row();</span>

<span class="nc" id="L222">        table.add(new Image(parent.skin.getDrawable(&quot;ball&quot;))).top().left().size(1.25f * TILE_SIZE);</span>
<span class="nc" id="L223">        ammo = new Label(&quot;N/A&quot;, parent.skin);</span>
<span class="nc" id="L224">        table.add(ammo).top().left().size(50);</span>

<span class="nc" id="L226">        table.top().left();</span>
<span class="nc" id="L227">    }</span>
}
</pre><div class="footer"><span class="right">Created with <a href="http://www.jacoco.org/jacoco">JaCoCo</a> 0.8.6.202009150832</span></div></body></html>