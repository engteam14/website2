<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../jacoco-resources/report.css" type="text/css"/><link rel="shortcut icon" href="../jacoco-resources/report.gif" type="image/gif"/><title>Pirate.java</title><link rel="stylesheet" href="../jacoco-resources/prettify.css" type="text/css"/><script type="text/javascript" src="../jacoco-resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../jacoco-sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">core</a> &gt; <a href="index.source.html" class="el_package">com.mygdx.game.Components</a> &gt; <span class="el_source">Pirate.java</span></div><h1>Pirate.java</h1><pre class="source lang-java linenums">package com.mygdx.game.Components;

import com.badlogic.gdx.math.Vector2;
import com.badlogic.gdx.utils.JsonValue;
import com.mygdx.game.Entitys.Ship;
import com.mygdx.game.Faction;
import com.mygdx.game.Managers.GameManager;
import com.mygdx.utils.QueueFIFO;

import java.util.HashMap;

/**
 * Gives the concepts of health plunder, etc. Allows for firing of cannonballs, factions, death, targets
 */
public class Pirate extends Component {
    /**
     * // Assessment 2 Change: Refactored to use map for storing values which will be modified by powerups.
     * The enemy that is being targeted by the AI.
     */
    private int factionId;
    private final HashMap&lt;String,Float&gt; defaults;
    private final HashMap&lt;String,Float&gt; values;
    //private int plunder;
    private int points;
    protected boolean isAlive;

    private boolean infiniteAmmo; // Added for Assessment 2 for power-ups and colleges

    private final QueueFIFO&lt;Ship&gt; targets;

    public Pirate() {
<span class="fc" id="L32">        super();</span>
<span class="fc" id="L33">        targets = new QueueFIFO&lt;&gt;();</span>
<span class="fc" id="L34">        type = ComponentType.Pirate;</span>
<span class="fc" id="L35">        factionId = 1;</span>
<span class="fc" id="L36">        isAlive = true;</span>

<span class="fc" id="L38">        values = new HashMap&lt;&gt;();</span>
<span class="fc" id="L39">        JsonValue starting = GameManager.getSettings().get(&quot;starting&quot;);</span>
<span class="fc" id="L40">        values.put(&quot;health&quot;, (float) starting.getInt(&quot;health&quot;));</span>
<span class="fc" id="L41">        values.put(&quot;damage&quot;, (float) starting.getInt(&quot;damage&quot;));</span>
<span class="fc" id="L42">        values.put(&quot;ammo&quot;, (float) starting.getInt(&quot;ammo&quot;));</span>
<span class="fc" id="L43">        values.put(&quot;plunder&quot;, (float) starting.getInt(&quot;plunder&quot;));</span>

<span class="fc" id="L45">        values.put(&quot;plunderRate&quot;, 1f);</span>
<span class="fc" id="L46">        values.put(&quot;defense&quot;, 1f);</span>

<span class="fc" id="L48">        defaults = new HashMap&lt;&gt;(values);</span>
<span class="fc" id="L49">    }</span>

    /**
     * // New for assessment 2 //
     * Get a Pirate value.
     * @param key   The value to get
     * @return      The value
     */
    public float getValue(String key) {
<span class="fc" id="L58">        return values.get(key);</span>
    }

    /**
     * // New for assessment 2 //
     * Set the default for a Pirate value.
     * @param key       The value to set to
     * @param value     The default to apply
     */
    public void setDefault(String key, float value) {
<span class="nc" id="L68">        values.replace(key, value);</span>
<span class="nc" id="L69">        defaults.replace(key, value);</span>
<span class="nc" id="L70">    }</span>

    /**
     * // New for assessment 2 //
     * Set a new value for Pirate while holding reference to what it was originally.
     * @param key       The value to set to
     * @param value     The float to apply
     */
    public void setValue(String key, float value) {
<span class="fc" id="L79">        values.replace(key, value);</span>
<span class="fc" id="L80">    }</span>

    /**
     * // New for assessment 2 //
     * Multiply a value for Pirate while holding reference to what it was originally.
     * @param key       The value to multiply
     * @param mult      The multiplication factor
     */
    public void multValue(String key, float mult) {
<span class="fc" id="L89">        values.replace(key, values.get(key) * mult);</span>
<span class="fc" id="L90">    }</span>

    /**
     * // New for assessment 2 //
     * Reset a Pirate value to what it originally was.
     * @param key       The value to reset
     */
    public void resetToDefault(String key) {
<span class="fc" id="L98">        values.replace(key, defaults.get(key));</span>
<span class="fc" id="L99">    }</span>

    public void addTarget(Ship target) {
<span class="fc" id="L102">        targets.add(target);</span>
<span class="fc" id="L103">    }</span>

    public int getPlunder() {
<span class="fc" id="L106">        return values.get(&quot;plunder&quot;).intValue();</span>
    }

    public int getPoints() {
<span class="fc" id="L110">        return points;</span>
    }

    public void addPlunder(int money) {
        // Assessment 2 change: Plunder additions are now multiplied by plunderRate value
<span class="fc" id="L115">        values.replace(&quot;plunder&quot; , values.get(&quot;plunder&quot;)+ Math.round(money * values.get(&quot;plunderRate&quot;)));</span>
<span class="fc" id="L116">    }</span>

    public void addPoints(int increment) {
<span class="fc" id="L119">        points += increment;</span>
<span class="fc" id="L120">    }</span>

    public Faction getFaction() {
<span class="fc" id="L123">        return GameManager.getFaction(factionId);</span>
    }

    public void setFactionId(int factionId) {
<span class="fc" id="L127">        this.factionId = factionId;</span>
<span class="fc" id="L128">    }</span>

    /**
     * Added for Assessment 2, sets whether the pirate can ignore ammo costs for firing
     * @param status boolean value to set infiniteAmmo to
     */
    public void setInfiniteAmmo(boolean status) {
<span class="fc" id="L135">        infiniteAmmo = status;</span>
<span class="fc" id="L136">    }</span>

    /**
     * Added for Assessment 2
     * @return the damage dealt by attacks from this unit
     */
    public Float getAttackDmg() {
<span class="fc" id="L143">        return values.get(&quot;damage&quot;);</span>
    }

    public void takeDamage(float dmg) {
        // Assessment 2 change: Refactored to include key for health instead of variable, as well as factor in new defense value
<span class="fc" id="L148">        dmg *= (1f/values.get(&quot;defense&quot;));</span>
<span class="fc" id="L149">        values.replace(&quot;health&quot;, getHealth() - dmg);</span>
<span class="fc bfc" id="L150" title="All 2 branches covered.">        if (getHealth() &lt;= 0) kill();</span>
<span class="fc" id="L151">    }</span>

    /**
     * Changed for Assessment 2:
     *  - Removed functionality and replaced with function call to a different function,
     *    to allow for differentiation between when a start position is or isn't provided.
     * @param direction the direction to shoot in
     */
    public void shoot(Vector2 direction) {
<span class="fc" id="L160">        shoot(parent.getComponent(Transform.class).getPosition().cpy(),direction);</span>
<span class="fc" id="L161">    }</span>

    /**
     * Added for Assessment 2
     * Will shoot a cannonball from the startPos in the direction, assigning this.parent as the cannonball's parent
     * @param direction the direction to shoot in
     */
    public void shoot(Vector2 startPos, Vector2 direction){
<span class="pc bpc" id="L169" title="1 of 4 branches missed.">        if(!infiniteAmmo &amp;&amp; (getAmmo() == 0)){</span>
<span class="nc" id="L170">            return;</span>
        }
<span class="fc bfc" id="L172" title="All 2 branches covered.">        if(!infiniteAmmo){</span>
<span class="fc" id="L173">            values.replace(&quot;ammo&quot;, getAmmo()-1f);</span>
        }
<span class="fc" id="L175">        GameManager.shoot(parent, startPos, direction);</span>
<span class="fc" id="L176">    }</span>

    public int getHealth() {
        // Assessment 2 change: Refactored to use key for health instead of variable
<span class="fc" id="L180">        return Math.round(values.get(&quot;health&quot;));</span>
    }

    /**
     * if dst to target is less than attack range
     * target will be null if not in agro range
     */
    public boolean canAttack() {
<span class="pc bpc" id="L188" title="1 of 2 branches missed.">        if (targets.peek() != null) {</span>
<span class="fc" id="L189">            final Ship p = (Ship) parent;</span>
<span class="fc" id="L190">            final Vector2 pos = p.getPosition();</span>
<span class="fc" id="L191">            final float dst = pos.dst(targets.peek().getPosition());</span>
            // withing attack range
<span class="pc bpc" id="L193" title="1 of 2 branches missed.">            return dst &lt; Ship.getAttackRange();</span>
        }
<span class="nc" id="L195">        return false;</span>
    }

    /**
     * if dst to target is &gt;= attack range
     * target will be null if not in agro range
     */
    public boolean isAgro() {
<span class="pc bpc" id="L203" title="1 of 2 branches missed.">        if (targets.peek() != null) {</span>
<span class="fc" id="L204">            final Ship p = (Ship) parent;</span>
<span class="fc" id="L205">            final Vector2 pos = p.getPosition();</span>
<span class="fc" id="L206">            final float dst = pos.dst(targets.peek().getPosition());</span>
            // out of attack range but in agro range
<span class="pc bpc" id="L208" title="1 of 2 branches missed.">            return dst &gt;= Ship.getAttackRange();</span>
        }
<span class="nc" id="L210">        return false;</span>
    }

    public Ship getTarget() {
<span class="nc" id="L214">        return targets.peek();</span>
    }

    public boolean isAlive() {
<span class="fc" id="L218">        return isAlive;</span>
    }

    /**
     * Kill its self
     */
    public void kill() {
        // Assessment 2 change: Refactored to use key for health instead of variable
<span class="fc" id="L226">        values.replace(&quot;health&quot;, 0f);</span>
<span class="fc" id="L227">        isAlive = false;</span>
<span class="fc" id="L228">    }</span>

    public void setAmmo(int ammo) {
        // Assessment 2 change: Refactored to use key for ammo instead of variable
<span class="fc" id="L232">        values.replace(&quot;ammo&quot;, (float) ammo);</span>
<span class="fc" id="L233">    }</span>

    public int getAmmo() {
        // Assessment 2 change: Refactored to use key for ammo instead of variable
<span class="fc" id="L237">        return Math.round(values.get(&quot;ammo&quot;));</span>
    }

    public QueueFIFO&lt;Ship&gt; getTargets() {
<span class="nc" id="L241">        return targets;</span>
    }

    //public int targetCount() {
    //        return targets.size();
    //    }

    //public void removeTarget() {
    //        targets.pop();
    //    }

    //public void reload(int ammo) {
    //        // Assessment 2 change: Refactored to use key for ammo instead of variable
    //        values.replace(&quot;ammo&quot;, (float) getAmmo()+ammo);
    //    }
}
</pre><div class="footer"><span class="right">Created with <a href="http://www.jacoco.org/jacoco">JaCoCo</a> 0.8.6.202009150832</span></div></body></html>